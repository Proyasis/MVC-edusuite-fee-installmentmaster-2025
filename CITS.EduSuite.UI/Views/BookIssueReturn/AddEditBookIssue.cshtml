@model CITS.EduSuite.Business.Models.ViewModels.BookIssueReturnMasterViewModel


@section scripts{
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/CitsValidation")
    @Scripts.Render("~/bundles/jqueryui")
    @Scripts.Render("~/Content/DatePickerJS")
    @Scripts.Render("~/Content/JqueryRepeater")
    @Scripts.Render("~/Scripts/BookIssueReturn")
}



<section class="section-content mx-sm-3 mx-0">

    <div class="form-master">

        @using (Html.BeginForm("AddEditBookIssue", "BookIssueReturn", FormMethod.Post, new { @id = "frmAddEditBookIssue" }))
        {
            if (!String.IsNullOrEmpty(Model.CardId))
            {
                @Html.AntiForgeryToken()
                @Html.HiddenFor(m => m.RowKey)
                @Html.HiddenFor(m => m.CardId)
                @Html.ValidationSummary(true)
                @Html.HiddenFor(m => m.DueDate)

                <input type="hidden" id="hdnCheckCardIdExists" value="@Url.Action("GetNumberofBooks", "BookIssueReturn")" />
                <input type="hidden" id="hdnAddEditBookReturnIssue" value="@Url.Action("AddEditBookIssue", "BookIssueReturn")" />
                <input type="hidden" id="hdnBookReturnIssueList" value="@Url.Action("BookIssueReturnList", "BookIssueReturn")" />
                <input type="hidden" id="hdnFillBook" value="@Url.Action("FillBook", "BookIssueReturn")" />
                <input type="hidden" id="hdnFillBookCopy" value="@Url.Action("FillBookCopy", "BookIssueReturn")" />
                <input type="hidden" id="hdnDeleteBookIssueReturnDetails" value="@Url.Action("DeleteBookIssueReturnDetails", "BookIssueReturn")" />
                <input type="hidden" id="hdnGetBookIssueReturnByValues" value="@Url.Action("GetBookIssueReturnByValues", "BookIssueReturn")" />

                <div class="form-row">
                    <div class="col-12">
                        @if (!String.IsNullOrEmpty(Model.CardId))
                        {
                            @Html.Action("LibraryDetail", "Shared", new { id = 0, CardId = Model.CardId })
                        }
                    </div>
                </div>
                <div class="form-row mt-3">
                    <div class="col-lg-2 col-sm-3 col-6">
                        <div class="form-group">
                            @Html.Label(EduSuiteUIResources.IssueDate, htmlAttributes: new { @id = "lblIssueDate", @class = "form-label" })<div class="required-icon"><div class="text">*</div></div>
                            @Html.TextBoxFor(m => m.IssueDate, "{0:dd/MM/yyyy}", new { @class = "form-control border-radius datetimepicker", @data_input_type = "date", @data_inputmask = "'alias': 'dd/mm/yyyy'" })
                            <span class="form-control-error-text">
                                @Html.ValidationMessageFor(m => m.IssueDate)
                            </span>
                        </div>
                    </div>
                    <div class="col-lg-2 col-sm-3 col-6">
                        <div class="form-group">
                            @Html.Label(EduSuiteUIResources.TotalBookAllowed, htmlAttributes: new { @id = "lblNumberofBooks", @class = "form-label red" })
                            @Html.TextBoxFor(m => m.NumberofBooks, new { @class = "form-control input-control", @InputFor = "lblNumberofBooks", @readonly = "readonly" })
                            <span class="form-control-error-text">
                                @Html.ValidationMessageFor(m => m.NumberofBooks)
                            </span>
                        </div>
                    </div>
                    <div class="col-lg-2 col-sm-3 col-6">
                        <div class="form-group">
                            @Html.Label(EduSuiteUIResources.BookTaketoRemain, htmlAttributes: new { @id = "lblNumberofBooksRemain", @class = "form-label red" })
                            @Html.TextBoxFor(m => m.NumberofBooksRemain, new { @class = "form-control input-control", @InputFor = "lblNumberofBooksRemain", @readonly = "readonly" })
                            <span class="form-control-error-text">
                                @Html.ValidationMessageFor(m => m.NumberofBooksRemain)
                            </span>
                        </div>
                    </div>
                    <div class="col-lg-2 col-sm-3 col-6">
                        <div class="form-group">
                            @Html.Label(EduSuiteUIResources.AllowedBookPerDay, htmlAttributes: new { @id = "lblNumberofBooksDay", @class = "form-label red" })
                            @Html.TextBoxFor(m => m.NumberofBooksDay, new { @class = "form-control input-control", @InputFor = "lblNumberofBooksDay", @readonly = "readonly" })
                            <span class="form-control-error-text">
                                @Html.ValidationMessageFor(m => m.NumberofBooksDay)
                            </span>
                        </div>
                    </div>
                    <div class="col-lg-2 col-sm-3 col-6">
                        <div class="form-group">
                            @Html.Label(EduSuiteUIResources.TodayRemainBooks, htmlAttributes: new { @id = "lblNumberofBooksDayRemain", @class = "form-label red" })
                            @Html.TextBoxFor(m => m.NumberofBooksDayRemain, new { @class = "form-control input-control", @InputFor = "lblNumberofBooksDayRemain", @readonly = "readonly" })
                            <span class="form-control-error-text">
                                @Html.ValidationMessageFor(m => m.NumberofBooksDayRemain)
                            </span>
                        </div>
                    </div>
                </div>
                <a id="click">hide</a>
                <div class="repeater">

                    <table class="table table-responsive  table-bordered ">
                        <thead>
                            <tr>
                                <th>

                                </th>
                                <th style="width:300px" class="toggleDisplay">
                                    @EduSuiteUIResources.BookCategory
                                </th>

                                <th style="width:300px" class="toggleDisplay">
                                    @EduSuiteUIResources.Book

                                </th>
                                <th style="width:300px">
                                    @EduSuiteUIResources.BookCopy

                                </th>
                                <th style="width:300px">
                                    @EduSuiteUIResources.Remarks

                                </th>
                            </tr>
                        </thead>
                        <tbody data-repeater-list>

                            @for (int i = 0; i < Model.BookIssueReturnDetails.Count(); i++)
                            {
                                <tr data-repeater-item>
                                    <td class="px-1">
                                        <span data-repeater-delete="" class="btn btn-danger btn-sm">
                                            <span class="fa fa-times-circle"></span>
                                        </span>
                                    </td>
                                    <td class="px-1 toggleDisplay" style="width:300px">
                                        <fieldset class="form-group">
                                            @Html.DropDownListFor(m => m.BookIssueReturnDetails[i].BookCategoryKey, new SelectList(Model.BookIssueReturnDetails[i].BookCategory, "RowKey", "Text"), EduSuiteUIResources.Select + EduSuiteUIResources.BlankSpace + EduSuiteUIResources.BookCategory, new { @class = "form-control border-radius input-control", @InputFor = "lblBookCategory", @onchange = "BookIssueReturn.GetBookByCatagory(this)" })
                                            <span class="form-control-error-text">
                                                @Html.ValidationMessageFor(m => m.BookIssueReturnDetails[i])
                                            </span>
                                            @Html.HiddenFor(m => m.BookIssueReturnDetails[i].RowKey)
                                        </fieldset>
                                    </td>
                                    <td class="px-1 toggleDisplay" style="width:300px">
                                        <fieldset class="form-group">
                                            @Html.DropDownListFor(m => m.BookIssueReturnDetails[i].BookKey, new SelectList(Model.BookIssueReturnDetails[i].Book, "RowKey", "Text"), EduSuiteUIResources.Select + EduSuiteUIResources.BlankSpace + EduSuiteUIResources.Book, new { @class = "form-control border-radius input-control ", @InputFor = "lblBook", @data_live_search = "true", @onchange = "BookIssueReturn.GetBookCopyByBook(this)" })
                                            <span class="form-control-error-text">
                                                @Html.ValidationMessageFor(m => m.BookIssueReturnDetails[i].BookKey)
                                            </span>
                                        </fieldset>
                                    </td>
                                    <td class="px-1" style="width:300px">
                                        <fieldset class="form-group">
                                            @Html.DropDownListFor(m => m.BookIssueReturnDetails[i].BookCopyKey, new SelectList(Model.BookIssueReturnDetails[i].BookCopy, "RowKey", "Text"), EduSuiteUIResources.Select + EduSuiteUIResources.BlankSpace + EduSuiteUIResources.BookCopy, new { @class = "form-control border-radius input-control", @InputFor = "lblBookCopy", @data_live_search = "true" })
                                            <span class="form-control-error-text">
                                                @Html.ValidationMessageFor(m => m.BookIssueReturnDetails[i].BookCopyKey)
                                            </span>
                                        </fieldset>
                                    </td>

                                    <td class="px-1" style="width:300px">
                                        <fieldset class="form-group">
                                            @Html.TextBoxFor(m => m.BookIssueReturnDetails[i].Remark, new { @class = "form-control input-control", @InputFor = "lblRemark" })
                                            <span class="form-control-error-text">
                                                @Html.ValidationMessageFor(m => m.BookIssueReturnDetails[i].Remark)
                                            </span>
                                        </fieldset>
                                    </td>


                                </tr>
                            }
                        </tbody>
                        <tfoot>
                            <tr>
                                <td class="px-1" colspan="5">
                                    <span data-repeater-create class="btn btn-info btn-sm">
                                        <span class="fa fa-plus-circle"></span>
                                    </span>
                                </td>
                            </tr>
                        </tfoot>
                    </table>


                </div>

                <div class="row mt-2">
                    <div class="col-12">
                        <div class="form-group">
                            <input type="button" value="@EduSuiteUIResources.Save" id="btnSave" class="btn btn-sm btn-success mx-1" onclick="BookIssueReturn.FormSubmit()" />
                            <input type="button" value="@EduSuiteUIResources.Cancel" onclick="location.href='@Url.Action("BookIssueReturnList", "BookIssueReturn")' " class="btn btn-sm btn-danger mx-1" />
                        </div>
                    </div>

                </div>
            }
            <div class="form-row">

                <span class="text-danger"><strong> @Html.ValidationMessage("error_msg")</strong>  </span>
            </div>
        }
    </div>
</section>
<script>
    var jsonData=@(Html.Raw(Json.Encode(Model)));
    $(document).ready(function () {
        BookIssueReturnDetails.GetBookIssueReturnDetails(jsonData);
        BookIssueReturn.GetIssueDetails(false);

        AppCommon.FormatDateInput();


        $("#IssueDate").on("changeDate", function () {
            BookIssueReturn.GetIssueDetails(true);
        });



    });
    $("#click").click(function () {
        $(".table .toggleDisplay").toggleClass("in");
    }); 
</script>

<style>
    /*.toggleDisplay {
        display: none;
    }

        .toggleDisplay.in {
            display: table-cell;
        }*/
</style>