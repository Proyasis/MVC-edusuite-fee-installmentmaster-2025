@model CITS.EduSuite.Business.Models.ViewModels.EnquiryReportViewModel
@using CITS.EduSuite.Business.Models.ViewModels

@using System.Web.Mvc

@section scripts{
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/Scripts/EnquiryLeadCountSummary")
    @Scripts.Render("~/Content/DatePickerJS")
    @Scripts.Render("~/Content/MultiselectJs")
    @Scripts.Render("~/Content/ExcelExportJS")
    @Scripts.Render("~/Content/momentJS")
    @Scripts.Render("~/Scripts/BaseStudentsSearch")
    @Scripts.Render("~/Scripts/StudentsSummary")
}




<input type="hidden" id="hdnEnquirySummary" value="@Url.Action("EnquirySummary", "Report")" />
<input type="hidden" id="hdnGetEmployeesByBranchId" value="@Url.Action("FillEmployeesById", "SelectList")" />
<input type="hidden" id="hdnGetCallReportsDetailed" value="@Url.Action("GetCallReportsDetailed", "Report")" />
<input type="hidden" id="hdnGetCallReportsData" value="@Url.Action("EnquiryandLeadReportData", "Report")" />
<input type="hidden" id="hdnGetReportHistory" value="@Url.Action("GetHistoryList", "Report")" />

<header class="section-header">
    <div class="row justify-content-between px-1">
        <div class="col-12">
            <div class="tbl">
                <div class="tbl-row">
                    <div class="tbl-cell">
                        <h3>@EduSuiteUIResources.Enquiry@EduSuiteUIResources.BlankSpace@EduSuiteUIResources.Summary</h3>

                    </div>
                </div>
            </div>
        </div>

    </div>
</header>
<section class="section-content mx-sm-3 mx-0">

    <div class="GridBody">
        <div class="grid-nav-bar">
            <form>
                @Html.HiddenFor(m => m.ScheduleTypeKeysList)
                <div class="form-row">
                    @if (Model.Branches.Count == 1)
                    {
                        {
                            Model.BranchKey = (Model.BranchKey == 0 || Model.BranchKey == null) ? (short)Model.Branches.Select(x => x.RowKey).FirstOrDefault() : Model.BranchKey;
                        }
                        @Html.HiddenFor(m => m.BranchKey)
                    }
                    else
                    {
                        <div class="col-lg-2 col-sm-4 col-6">
                            <fieldset class="form-group">
                                @Html.DropDownListFor(m => m.BranchKey, new SelectList(Model.Branches, "RowKey", "Text"), EduSuiteUIResources.Branch, new { @class = "form-control input-control ", @data_live_search = "true" })
                            </fieldset>
                        </div>
                    }

                    <div class="col-lg-2 col-sm-3 col-4">
                        <fieldset class="form-group">
                            @Html.DropDownListFor(m => m.EmployeeKey, new SelectList(Model.Employees, "RowKey", "Text"), EduSuiteUIResources.Select + EduSuiteUIResources.BlankSpace + EduSuiteUIResources.Employee, new { @class = "form-control input-control  selectpicker", @data_live_search = "true", @InputFor = "lblEmployee" })
                        </fieldset>
                    </div>

                    <div class="col-lg-1 col-sm-2 col-3">
                        <fieldset class="form-group">
                            @Html.TextBoxFor(m => m.SearchFromDate, "{0:dd/MM/yyyy}", new { @class = "form-control input-control", @data_input_type = "date", @data_inputmask = "'alias': 'dd/mm/yyyy'", @placeholder = "" + @EduSuiteUIResources.FromDate + "" })
                        </fieldset>
                    </div>
                    <div class="col-lg-1 col-sm-2 col-3">
                        <fieldset class="form-group">
                            @Html.TextBoxFor(m => m.SearchToDate, "{0:dd/MM/yyyy}", new { @class = "form-control input-control", @data_input_type = "date", @data_inputmask = "'alias': 'dd/mm/yyyy'", @placeholder = "" + @EduSuiteUIResources.ToDate + "" })
                        </fieldset>
                    </div>

                    <div class="col-lg-1 col-sm-3 col-2 ">
                        <fieldset class="form-group">
                            <button type="button" id="btnSearch" class="btnForm btnSubmit btn btn-sm btn-success">@EduSuiteUIResources.Search</button>
                        </fieldset>
                    </div>
                   
                    <div class="col-lg-2 col-sm-3 col-4">
                        <div class="checkbox-bird green inline-block">
                            @Html.CheckBoxFor(m => m.IsSelected, new { @class = "switch-input" })
                            <label for="IsSelected">Hide Empty Record</label>
                        </div>
                    </div>
                    <div class="col-lg-3 col-sm-3 col-4">
                        <div class="button-group float-right">
                            <button id="btnPrint" type="button" onclick="StudentSummary.GetExportPrintData('P','#hdnEnquirySummary','EnquiryCountSummary','Enquiry Count Summary',true)" class="btn btn-primary btn-sm"><i class="fa fa-print btn-blue" aria-hidden="true"></i></button>
                            <button id="btnExport" type="button" onclick="StudentSummary.GetExportPrintData('E','#hdnEnquirySummary','EnquiryCountSummary','Enquiry Count Summary',true)" class="btn btn-success btn-sm"><i class="fa fa-file-excel-o fa-align-right" aria-hidden="true"></i></button>

                        </div>
                    </div>
                </div>

            </form>

        </div>

        <div class="table-wrapper">

            <div class="jqGrid_wrapper overflow-auto">
                <table id="grid" class="table table-striped"></table>
                <div id="pager"></div>
            </div>
        </div>
    </div>

</section>

<script type="text/javascript">
    var jsonData=@(Html.Raw(Json.Encode(Model)));
    $(document).ready(function ()
    {

        AppCommon.FormatDateInput();
        AppCommon.FormatSelect2();

        EnquiryLeadCountSummary.GetEnquirySummary(jsonData);

        $('#btnSearch').on("click", function ()
        {
            EnquiryLeadCountSummary.GetEnquirySummary(jsonData);
            /*ShowHideEmptyRecords();*/
        });

        $('#SearchAnyText').on("input", function ()
        {
            EnquiryLeadCountSummary.GetEnquirySummary(jsonData);
           /* ShowHideEmptyRecords();*/

        });

        $("#IsSelected").on("change", function () {
            EnquiryLeadCountSummary.GetEnquirySummary(jsonData);
        });


        $("#BranchKey").on("change", function () {
            var obj = {};
            obj.BranchKey = $("#BranchKey").val() != "" ? $("#BranchKey").val() : 0;
            AppCommon.BindDropDownbyId(obj, $("#hdnGetEmployeesByBranchId").val(), $("#EmployeeKey"), Resources.Employee);
        });

    });

    function LoadHistory(object) {

        $("#ClosedFeedbackList").empty();
        $(".tempRow").remove();
        var RowIndex = parseInt($(object).closest('td').parent()[0].sectionRowIndex);
        var MobileNumber = $(object).attr("mobilenumber");
        var TelephoneCodeKey = $(object).attr("telephonecode");
        MobileNumber = MobileNumber.substr(2, MobileNumber.length)


        var Obj = {};
        Obj.TelephoneCodeKey = TelephoneCodeKey;
        Obj.MobileNumber = MobileNumber;
        Obj.RowIndex = RowIndex;

        EnquiryLeadCountSummary.GetHistoryByMobileNumber(Obj);


    }
</script>

<style>
    a.multiselect-all {
        display: none !important;
    }

    .CustomizeCol .multiselect-container {
        max-height: 100vh !important;
    }

    .TotalCount {
        color: #dc0a0a;
        font-size: 14px;
        background: #ffffff;
        text-align: center;
        min-width: 113px;
        padding: 5px 3px;
        font-size: 13px;
    }

    button.multiselect {
        min-width: 114px;
        height: 25px;
        padding: 3px 6px;
        box-shadow: none !important;
    }

        button.multiselect:hover {
            background: white !important;
            box-shadow: none !important;
        }

    #CallReportContentDiv {
        display: none;
    }





    span.callHistory:hover {
        transform: scale(1.1) !important;
        background: #05961d;
        display: inline-block;
        color: white;
        transition: 0.5s;
    }


    span.callHistory {
        background: #d6d6d6;
        padding: 0px 6px;
        color: #6b1b1b;
        border-radius: 1px;
        cursor: pointer;
        transition: 0.5s;
    }

    span#feedbackToolTip {
        transform: scale(0);
        transition: 0.3s;
        display: none;
        font-size: 13px !important;
    }

    .ReportTable tr:hover span#feedbackToolTip {
        position: fixed;
        background: #000000;
        padding: 6px;
        top: 0px;
        right: 0px;
        left: 0px;
        margin: auto;
        width: 52%;
        text-align: center;
        border-radius: 0px;
        color: white;
        font-size: 11px;
        transition: 0.3s;
        transform: scale(1) !important;
        display: block !important;
    }

    .label {
        display: inline;
        padding: .2em .6em .3em;
        font-size: 75%;
        font-size: 8px;
        font-weight: 700;
        line-height: 0;
        color: #fff;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: 0px;
        min-width: 55px !important;
        display: inline-block;
        padding: 8px;
        text-align: center;
        padding-bottom: 9px;
        position: relative;
        top: -3px;
    }

    span.lblDate {
        background: #f9ff9f;
        padding: 0px 10px;
        padding-bottom: 2px;
        color: #880606;
    }
</style>



