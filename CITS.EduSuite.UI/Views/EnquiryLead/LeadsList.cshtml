
@model CITS.EduSuite.Business.Models.ViewModels.EnquiryLeadViewModel

@using System.Web.Mvc
@using CITS.EduSuite.Business.Models.Resources
@section scripts{

    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/CitsValidation")
    @Scripts.Render("~/Content/Select2JS")
    @Scripts.Render("~/Content/DatePickerJS")
    @Scripts.Render("~/Scripts/LeadManagement")
    @Scripts.Render("~/Content/MultiSelectJs")
    @Scripts.Render("~/Content/momentJS")

    @Scripts.Render("~/Scripts/Common")

}

<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="~/CITSEduSuiteScripts/LeadManagement.js"></script>

<input type="hidden" id="hdnGetLeads" value="@Url.Action("GetLeadsAllocation", "EnquiryLead")" />

<input type="hidden" id="hdnGetEmployeesByBranchId" value="@Url.Action("GetEmployeeByBranchId", "EnquiryLead")" />


<script src="~/CITSEduSuiteScripts/selection.js"></script>

<header class="section-header">
    <div class="row justify-content-between px-1">
        <div class="col-sm-6 col-12">
            <div class="tbl">
                <div class="tbl-row">
                    <div class="tbl-cell">
                        <h3>@EduSuiteUIResources.Lead</h3>

                    </div>
                </div>
            </div>
        </div>

    </div>
</header>
<section class="section-content mx-sm-3 mx-0">
    <div class="GridBody">

        <div class="grid-nav-bar">
            <div class=" form-row ">

                <div class="col-lg-2 col-sm-3 col-6">
                    <div class="form-group">
                        <input id="SearchText" type="text" name="focus" class="input-control form-control form-control-sm" placeholder="@EduSuiteUIResources.Search" /> @* Change Search TextBox Placeholder*@
                        <span id="iconSpan" class="iconSpan"><i class="fa fa-times-circle" aria-hidden="true"></i></span>
                    </div>
                </div>
                <div class="col-lg-2 col-sm-3 col-6">
                    <div class="form-group">
                        @Html.DropDownListFor(m => m.SearchBranchKey, new SelectList(Model.Branches, "RowKey", "Text"), EduSuiteUIResources.Select + EduSuiteUIResources.BlankSpace + EduSuiteUIResources.Branch, new { @class = "input-control form-control form-control-sm form-control-sm", @InputFor = "lblBranch" })
                    </div>
                </div>
                <div class="col-lg-2 col-sm-3 col-6">
                    <div class="form-group">
                        @Html.DropDownListFor(m => m.SearchEmployeeKey, new SelectList(Model.Employees, "RowKey", "Text"), EduSuiteUIResources.Select + EduSuiteUIResources.BlankSpace + EduSuiteUIResources.Employee, new { @class = "input-control form-control form-control-sm form-control-sm", @InputFor = "lblBranch" })

                    </div>
                </div>

                <div class="col-lg-2 col-sm-3 col-6">
                    <div class="form-group">
                        @Html.DropDownListFor(m => m.SearchEnquiryLeadStatusKey, new SelectList(Model.EnquiryLeadStatuses, "RowKey", "Text"), EduSuiteUIResources.Select + EduSuiteUIResources.BlankSpace + EduSuiteUIResources.EnquiryStatus, new { @class = "input-control form-control form-control-sm form-control-sm", @InputFor = "lblBranch" })
                    </div>
                </div>

                <div class="col-lg-2 col-sm-3 col-6">
                    <div class="form-group">
                        @Html.TextBoxFor(m => m.SearchFromDate, "{0:dd/MM/yyyy}", new { @class = "input-control form-control form-control-sm", @InputFor = "lblAdmissionNo", @placeholder = "Date from", @data_input_type = "date", @data_inputmask = "'alias': 'dd/mm/yyyy'" })
                    </div>
                </div>

                <div class="col-lg-2 col-sm-3 col-6">
                    <div class="form-group">
                        @Html.TextBoxFor(m => m.SearchToDate, "{0:dd/MM/yyyy}", new { @class = "input-control form-control form-control-sm", @InputFor = "lblAdmissionNo", @placeholder = "Date to", @data_input_type = "date", @data_inputmask = "'alias': 'dd/mm/yyyy'" })
                    </div>
                </div>

                <div class=" col-12">
                    <a class="btn btn-success btn-sm float-right " onclick='Leads.GetLeads();'>
                          Search
                    </a>
                </div>
            </div>
            <div class=" form-row ">
                <div class="col-sm-6">
                    <ul class="nav nav-tabs LeadStatusFilter">
                        <li class="nav-item">
                            <a class="nav-link active" data-toggle="tab" value="" href="#home">All</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" value="0" href="#menu2">Unallocated</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" value="1" href="#menu1">Allocated</a>
                        </li>

                    </ul>
                </div>


            </div>
        </div>



        <div class="table-wrapper">

            <div class="jqGrid_wrapper overflow-auto">
                <table id="grid"></table>
                <div id="pager"></div>
            </div>
        </div>



    </div>
</section>


<div style="display:none;left: 388.038px; top: 505.625px;" id="selection">
    <a id="addEditCourseType" data-href="@Url.Action("AddEditLeadAllocation", "EnquiryLead")" class="btn btn-success btn-sm "><i class="fa fa-plus-square-o"></i> <span>Allocate Leads</span></a>
    <button type="button" onclick="$('#selection').hide()" class="btn btn-sm btn-danger mx-1">Close</button>
    <ul id="selectionList"></ul>
    <style>
        #selection {
            position: fixed;
            z-index: 122;
            right: 11%;
            background: white;
            width: 300px;
            padding: 8px 18px;
            margin-top: -29%;
            box-shadow: 0px 0px 8px #babaca;
            height: 85%;
            overflow: auto;
            border-radius: 8px;
        }

        ul#selectionList li {
            background: white;
            width: 100%;
            float: left;
            border-bottom: solid #d4e3fd 1px;
            padding: 5px 3px;
            font-size: 13px;
        }

        @@media (max-width: 716px) 
        {
            #selection {
                border-radius: 8px;
                left: initial !important;
                right: 0px !important;
                width: 232px;
                margin-top: -110% !important;
                height: 250px;
            }

        }
    </style>

</div>


<script>


    $(document).ready(function () {


        AppCommon.EditGridPopup($("#addEditCourseType"))

        $("#selection").draggable();

        AppCommon.FormatDateInput();

        $("#SearchText,#SearchBranchKey,#SearchEmployeeKey,#SearchEnquiryLeadStatusKey").on("input change", function () {
            Leads.GetLeads();
        });


        $("#SearchBranchKey,#SearchEmployeeKey,#SearchEnquiryLeadStatusKey").on("select change", function () {
            Leads.GetLeads();
        });
        Leads.GetLeads();
        AppCommon.EditGridPopup($("#addEditClientPages"))


        $(document).on('change', '.addLead', function () {

            if ($(this).prop("checked") == true) {
                selection.NewSelection($(this).attr("selection_value"), $(this).attr("text"));
            }
            else {
                selection.RemoveSelection($(this).attr("selection_value"));
            }

        });


        $(".LeadStatusFilter a").click(function () {

            setTimeout(function () {
                Leads.GetLeads();

            }, 100);

        });

    });


</script>
<script>
    $(document).ready(function () {
        $(function () {
            $("#data_206").draggable();
        });
    });
</script>
<style>
    i.fa.fa-list {
        background: #ede9e1;
        padding: 2px 4px;
        color: #949090;
        border: solid #d3cdc3 1px;
    }

    .listPreview {
        position: fixed;
        background: white;
        width: 381px;
        margin-left: -381px;
        float: left;
        top: 177px;
        padding: 10px 12px;
        box-shadow: 0px 0px 4px #b5b4b4;
        z-index: 99;
        height: 500px;
        overflow-x: hidden;
    }

        .listPreview .row {
            background: white;
            float: left;
            width: 100%;
            padding: 6px 1px;
            border-bottom: solid #e8e7e5 1px;
        }

    .divEditDelete {
        height: 7px;
        margin-top: 3px;
    }

    .listPreview .col-sm-4 {
        font-weight: 600;
    }

    .btnReTransfer {
        background: #09b06d;
        font-size: 11px;
        padding: 2px 4px;
        color: white !important;
        border-radius: 1px;
        padding: 3px 5px;
        padding-top: 1px;
    }

        .btnReTransfer .fa {
            font-size: 11px;
        }

    a.btnRetransferAll {
        background: #cc1717;
        padding: 5px 9px;
        font-size: 13px;
        color: white;
        border-radius: 3px;
    }

    span.rmvItem {
        background: #e8e7e7;
        padding: 0px 5px;
        border-radius: 0px;
        padding-bottom: 3px;
        right: 10px;
        display: inline-block;
        position: absolute;
        color: #d80000;
        border-radius: 50%;
    }
</style>