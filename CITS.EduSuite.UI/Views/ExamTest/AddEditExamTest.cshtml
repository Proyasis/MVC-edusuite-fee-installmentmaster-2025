@model CITS.EduSuite.Business.Models.ViewModels.ExamTestViewModel
@using CITS.EduSuite.Business.Models.ViewModels
@section scripts{
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/Content/JqueryRepeater")
    @Scripts.Render("~/bundles/CitsValidation")
    @Scripts.Render("~/Scripts/ExamTest")
}

<input type="hidden" id="hdnExamTestList" value="@Url.Action("ExamTestList", "ExamTest")" />
<input type="hidden" id="hdnQuestionPaperDetail" value="@Url.Action("QuestionPaperDetail", "ExamTest")" />
<input type="hidden" id="hdnGetFileTypeById" value="@Url.Action("GetFileTypeById", "TestPaper")" />
<input type="hidden" id="hdnExamQuestions" value=@Url.Content("~/Templates/ExamTemplate/ExamQuestions.html") />
<input type="hidden" id="hdnUpdateTestPaperKey" value=@Url.Action("UpdateTestPaperKey", "ExamTest") />
<input type="hidden" id="hdnUpdateExamKey" value=@Url.Action("UpdateExamKey", "ExamTest") />
<input type="hidden" id="hdnComplateExam" value="@Url.Action("ShowExamReview", "ExamTest")/@Model.TestPaperKey" />
<input type="hidden" id="hdnIsShowAllQuestions" value="@Model.IsShowAllQuestions.ToString()" />


<script>
    async function startCapture(displayMediaOptions) {
        let captureStream = null;

        try {
            captureStream = await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);
        } catch (err) {
            console.error("Error: " + err);
        }
        return captureStream;
    }
</script>


@*<header class="section-header">
        <div class="row justify-content-between px-1">
            <div class="col-12">
                <div class="tbl">
                    <div class="tbl-row  px-1">
                        <div class="tbl-cell">
                            <h3>@EduSuiteUIResources.ExamTest</h3>
                            <ol class="breadcrumb breadcrumb-simple mb-2 float-sm-right">
                                <li><a href="#" onclick="location.href='@Url.Action("ExamTestList", "ExamTest")' ">@EduSuiteUIResources.ExamTest</a></li>
                                <li class="active">@EduSuiteUIResources.Add@EduSuiteUIResources.Hyphen@EduSuiteUIResources.Edit@EduSuiteUIResources.BlankSpace@EduSuiteUIResources.ExamTest</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>*@
@using (Html.BeginForm("AddEditExamTest", "ExamTest", FormMethod.Post))
{
    @Html.HiddenFor(m => m.RowKey)
    @Html.HiddenFor(m => m.ExamTestSectionKey)
    @Html.HiddenFor(m => m.TestPaperKey)
    @Html.HiddenFor(m => m.ApplicationKey)
    @Html.HiddenFor(m => m.ModuleKey)
    @Html.HiddenFor(m => m.ExamStart)
    @Html.HiddenFor(m => m.InstructionFileName)
    @Html.HiddenFor(m => m.ExamDuration)
    @Html.HiddenFor(m => m.EndTimeMilliSeconds)
    <input type="hidden" id="ExamDuration" value="30" />
    @Html.Hidden("QuestionNumber", 1)


    @Html.Hidden("IsExam", true)


    if (Model.ExamStatusKey != DbConstants.OnlineExamStatus.Finished)
    {

        <section class="tabs-section section-content  mx-sm-3 mx-0  position-relative mt-4">
            <div class="tabs-section-nav tab-exam">
                <ul id="tab-questionmodule" class="nav" role="tablist">
                    @if (Model.TestModules.Count > 1)
                    {
                        foreach (var item in Model.TestModules)
                        {
                            <li class="nav-item">
                                <a aria-controls="discover" role="tab" class="nav-link disabled" data-toggle="tab" data-val='@item.ModuleKey'>
                                    <div class="card b-a">
                                        <div class="card-heading no-border lt text-center">
                                            <div class="row">
                                                <div class="exam_box col-12">
                                                    <div id="tp-bg" class="">
                                                        <div class="exam-icon"><i id="tp-icon" class="fa" aria-hidden="true"></i></div>
                                                        <div class="exam_info">
                                                            <div class="big_t">@item.ModuleName</div>
                                                            @if ((item.TestDuration ?? 0) > 0)
                                                            {
                                                                <span>(@item.TestDuration minutes)</span>
                                                            }
                                                            else
                                                            {
                                                                <span>&nbsp;</span>
                                                            }
                                                            <hr class="my-2">
                                                            @if (item.TotalMark != null)
                                                            {
                                                                <p>Band Score    :     @String.Format("{0:G29}", item.TotalMark)</p>
                                                            }
                                                            else
                                                            {
                                                                if (DbConstants.QuestionModule.AswerKeyModules.Contains(item.ModuleKey))
                                                                {
                                                                    <p>@item.SectionCount sections, @item.QuestionCount items</p>
                                                                }
                                                                else if (DbConstants.QuestionModule.Writing == item.ModuleKey)
                                                                {
                                                                    <p>@item.QuestionCount Tasks</p>
                                                                }
                                                                else if (DbConstants.QuestionModule.Speaking == item.ModuleKey)
                                                                {
                                                                    <p>@item.QuestionCount part one-on-one conversation</p>
                                                                }
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    @*<span class="nav-link-in">
                                            @item.Text
                                        </span>*@
                                </a>
                            </li>
                        }
                    }

                </ul>

            </div>

            <div data-hidden id="examPersonDetails">

                <div class="form-row">
                    <div class=" ">
                        <div class="ProfilePhoto">
                            @if (Path.GetExtension(Model.StudentProfilePhoto) != "")
                            {
                                <img style="width:100%;height:100%" src="@Url.Content(Model.StudentProfilePhoto)" />
                            }
                            else
                            {
                                <img style="width:100%;height:100%" src="~/img/DefaultPhoto.png" />
                            }
                        </div>
                    </div>

                    <div style="    position: absolute;  margin-left: 99px;" class="col col-md-10 col-sm-12    ">
                        <div class="form-row examPersonDetails">
                            <div class="col-lg-2 col-md-2  col-sm-6   col-4 col-xs-6">Student Name</div>
                            <div class="col-lg-3 col-md-3  col-sm-6  col-4 col-xs-6" id="SpnApplicantName">:@Model.ApplicantName</div>
                        </div>
                        <div class="form-row examPersonDetails">
                            <div class="col-lg-2  col-md-2 col-sm-6  col-4 col-xs-6">Test Paper</div>
                            <div class="col-lg-3  col-md-3 col-sm-6  col-4 col-xs-6" id="SpnTestPaperName">:@Model.SubjectName @Model.TestPaperName</div>
                        </div>
                        <div class="form-row examPersonDetails">
                            <div class="col-lg-2  col-md-2 col-sm-6  col-4 col-xs-6">No Questions</div>
                            <div class="col-lg-3  col-md-3 col-sm-6  col-4 col-xs-6" id="SpnTestPaperName">:@Model.TestSections.Count()</div>
                        </div>
                        <div class="form-row examPersonDetails">
                            <div class="col-lg-2  col-md-2 col-sm-6  col-4 col-xs-6">Total Score</div>
                            <div class="col-lg-3  col-md-3 col-sm-6  col-4 col-xs-6" id="SpnTestPaperName">:@Model.MaximumScore</div>
                        </div>
                    </div>

                </div>
            </div>
            <div id="dvTestContaner" class="form-row">

                @*<div data-hidden id="examPersonDetails" class="examPersonDetails col col-12">
                        <div style="text-align:left" class="row">
                            <div class="col col-2 col-sm-6 col-md-2">Applicant Name</div>  <div class="col col-6 col-md-2" id="SpnApplicantName"></div>
                        </div>
                        <div style="text-align:left" class="row">
                            <div class="col col-2 col-sm-6  col-md-2">Test Paper</div>  <div class="col col-6 col-md-2" id="SpnTestPaperName"></div>
                        </div>
                    </div>*@



                <div data-hidden id="ExamReview" class="ExamReview col-sm-12">
                    <table>
                        <tr>
                            <td>Not Answered </td>
                            <td> Answered </td>
                            <td>Answered & Marked for Review <a style="    color: #04d004;">(considered for evalution)</a> </td>
                            <td> Marked for Review <br /> <a style="color:#af0202">(You have NOT answered the question, but have marked the question for review.)</a>  </td>
                            <td id="ntVisited" data-hidden>Not Visited</td>

                        </tr>
                        <tr>
                            <td><span id="NtAnsweredCount"></span></td>
                            <td><span id="AnsweredCount"></span></td>
                            <td><span id="AnsweredMarkedForReviewCount"></span></td>
                            <td><span id="MarkedForReviewCount"></span></td>
                            <td id="ntVisited" data-hidden><span id="NtVisitedCount"></span></td>

                        </tr>
                    </table>

                </div>


                <div id="ExamResultDetails" data-hidden class="ExamReview col-sm-12">


                    <table>
                        <tr>
                            <th>Total Questions</th>
                            <th>Total Attempted </th>
                            <th> Correct Answers <i style="    color: #0c9e0c;" class="fa fa-check"></i> </th>
                            <th> Incorrect Answers <i class="fa  fa-times-circle text-danger"></i> </th>
                            <th> Negative Marks</th>
                            <th> Score</th>
                        </tr>
                        <tr>
                            <td><span id="SpnTotalQuestions"></span></td>
                            <td><span id="SpnTotalAttempted"></span></td>
                            <td><span id="SpnCorrectAnsweres"></span></td>
                            <td><span id="SpnIncorrectAnswers"></span></td>
                            <td><span id="spnNegativeMarks"></span></td>
                            <td><span id="spnScore"></span></td>
                        </tr>
                    </table>
                </div>


                <div style="margin-top: 12px;" data-hidden id="divMessage" class="col-12">
                    @*<div class="alert alert-danger" role="alert">

                        </div>*@
                    <div class="alert alert-success" role="alert">
                        @EduSuiteUIResources.ExamSubmited,@EduSuiteUIResources.ResultsNotUpdated
                    </div>
                </div>


                <div class="col-12 col-sm-12 exam-paper mx-3 ">
                    <div class="green-audio-player mb-3">
                        <div id="dvDuration"></div>
                        <div id="dvAudioFile" data-hidden></div>
                        @* <button id="btnRead" type="button" class="btn btn-primary btn-sm float-right" data-toggle="modal" data-target="#supportFileModal" data-hidden>Read</button>*@
                        <button id="btnSkip" type="button" class="btn btn-primary btn-sm float-right" data-hidden>Skip <i class="fa fa-fast-forward"></i> </button>

                        @*<div id="dvMark" data-hidden class="mark-round failed">
                                <span class="mark-acheived">6</span>
                                <span class="mark-total">9</span>
                            </div>*@
                    </div>

                    <div class="form-row justify-content-between mt-2">
                        <div data-hidden id="dvQuestionNumber" class="col-12 col-sm-8 col-lg-10">
                            <div class="btn-group d-table">
                                @for (int i = 0; i < Model.TestSections.Count(); i++)
                                {
                                    for (int j = 0; j < Model.TestSections[i].QuestionDetails.Count(); j++)
                                    {

                                        if (!Model.IsShowAllQuestions)
                                        {
                                            <button type="button" class="btn btn-primary-outline btn-sm position-relative active" data-questionstatus="1" data-question="@Model.TestSections[i].QuestionDetails[j].QuestionNumber">
                                                <span>@Model.TestSections[i].QuestionDetails[j].QuestionNumber</span>
                                            </button>
                                        }
                                        else
                                        {
                                            <button type="button" class="btn btn-primary-outline btn-sm position-relative active" data-questionstatus="2" data-question="@Model.TestSections[i].QuestionDetails[j].QuestionNumber">
                                                <span>@Model.TestSections[i].QuestionDetails[j].QuestionNumber</span>
                                            </button>
                                        }
                                    }
                                }



                            </div>
                        </div>
                    </div>





                    <div data-hidden id="dvExamInstructions">
                        <h3 class="text-center">Please read the instructions carefully</h3>
                        <h4>General Instructions</h4>

                        @if (!Model.IsShowAllQuestions)
                        {
                            <ol>
                                <li> Total duration of test paper @Model.SubjectName is @Model.ExamDuration min.</li>
                                <li> The clock will be set at the server. The countdown timer in the top right corner of screen will display the remaining time available for you to complete the examination. When the timer reaches zero, the examination will end by itself. You will not be required to end or submit your examination.</li>
                                <li>The Questions Palette displayed on the right side of screen will show the status of each question using one of the following symbols:</li>
                                <li>
                                    <span>
                                        <a class="notVisited PageCommon"></a> You have not visited the question yet.
                                    </span>

                                    <span>
                                        <a class="MarkedForReview PageCommon"></a> You have NOT answered the question, but have marked the question for review.
                                    </span>
                                    <span>
                                        <a class="AnsweredMarkedForReview PageCommon"></a> The question(s) "Answered and Marked for Review" will be considered for evalution.
                                    </span>
                                    <span>
                                        <a class="Answered PageCommon"></a>  You have answered the question.
                                    </span>

                                    <span> <a class="NotAnswered PageCommon"></a> You have not answered the question.   </span>

                                </li>



                            </ol>

                            <h4>Navigating to a Question:</h4>
                            <ol start="5">
                                <li>
                                    To answer a question, do the following:
                                    <ol type="a">
                                        <li>To select you answer, click on the button of one of the options.</li>
                                        <li>To deselect your chosen answer, click on the button of the chosen option again</li>
                                        <li>To change your chosen answer, click on the button of another option</li>
                                        <li>To save your answer, you MUST click on the Save &amp; Next button.</li>
                                        <li>To mark the question for review, click on the Mark for Review &amp; Next button.</li>
                                    </ol>
                                </li>



                            </ol>


                            <h4>Answering a Question:</h4>

                            <ol start="7">
                                <li>
                                    Procedure for answering a multiple choice type question
                                    <ol type="a">
                                        <li>To select you answer, click on the button of one of the options.</li>
                                        <li>To change your chosen answer, click on the button of another option</li>
                                        <li>To save your answer, you MUST click on the <b> Save & Next </b> button.</li>
                                        <li>To mark the question for review, click on the <b>Mark for Review & Next</b> button.</li>
                                    </ol>
                                </li>
                            </ol>

                            <h4>Navigating through sections:</h4>
                            <ol start="8">
                                <li>
                                    <ol>
                                        <li>Sections in this question paper are displayed on the top bar of the screen. Questions in a section can be viewed by click on the section name. The section you are currently viewing is highlighted.</li>
                                        <li>After click the <b>Save & Next </b> button on the last question for a section, you will automatically be taken to the first question of the next section.</li>
                                        <li>You can shuffle between sections and questions anything during the examination as per your convenience only during the time stipulated.</li>
                                        <li>Candidate can view the corresponding section summery as part of the legend that appears in every section above the question palette.</li>
                                    </ol>
                                </li>
                            </ol>


                        }
                        else
                        {
                            <ol>
                                <li> Total duration of test paper @Model.SubjectName is @Model.ExamDuration min.</li>
                                <li> The clock will be set at the server. The countdown timer in the top right corner of screen will display the remaining time available for you to complete the examination. When the timer reaches zero, the examination will end by itself. You will not be required to end or submit your examination.</li>



                            </ol>

                            <ol>
                                <li> Total duration of test paper @Model.SubjectName is @Model.ExamDuration min.</li>
                                <li> The clock will be set at the server. The countdown timer in the top right corner of screen will display the remaining time available for you to complete the examination. When the timer reaches zero, the examination will end by itself. You will not be required to end or submit your examination.</li>
                                <li>The Questions Palette displayed on the right side of screen will show the status of each question using one of the following symbols:</li>
                                <li>
                                    <span>
                                        <a class="notVisited PageCommon"></a> You have not visited the question yet.
                                    </span>

                                    <span>
                                        <a class="MarkedForReview PageCommon"></a> You have NOT answered the question, but have marked the question for review.
                                    </span>
                                    <span>
                                        <a class="AnsweredMarkedForReview PageCommon"></a> The question(s) "Answered and Marked for Review" will be considered for evalution.
                                    </span>
                                    <span>
                                        <a class="Answered PageCommon"></a>  You have answered the question.
                                    </span>

                                    <span> <a class="NotAnswered PageCommon"></a> You have not answered the question.   </span>

                                </li>



                            </ol>


                            <h4>Navigating to a Question:</h4>
                            <ol start="5">
                                <li>
                                    To answer a question, do the following:
                                    <ol type="a">
                                        <li>To select you answer, click on the button of one of the options.</li>
                                        <li>To deselect your chosen answer, click on the button of the chosen option again</li>
                                        <li>To change your chosen answer, click on the button of another option</li>
                                        <li>To mark the question for review, click on the Mark for Review &amp; Next button.</li>
                                    </ol>
                                </li>



                            </ol>


                        }

                        <div id="ExamInstructions">

                        </div>


                        <p class="agreeText" style="    font-weight: bold;
    padding: 19px 0px;    margin: 0px;">
                            I have read and understood the instructions. All computer hardware allotted to me are in proper working condition. I declare that I am not in possession of / not wearing / not carrying any prohibited gadget like mobile phone, bluetooth devices etc. /any prohibited material with me into the Examination Hall.I agree that in case of not adhering to the instructions, I shall be liable to be debarred from this Test and/or to disciplinary action, which may include ban from future Tests / Examinations
                        </p>

                        <input style="    position: relative; bottom: -8px;" type="checkbox" id="chkAgree" /> <label style="display:inline-block" for="chkAgree"> <b>I AGREE</b></label>

                        <div class="col col-sm-12">

                            <button type="button" id="btnStart" data-hidden class="btn btn-sm btn-success mx-1 float-left"> @EduSuiteUIResources.Start</button>
                        </div>
                    </div>

                    @{
                        string display = "block";

                        if (!Model.IsShowAllQuestions)
                        {
                            display = "none";
                        }
                    }


                    <div data-hidden id="dvExamPaper">
                        @for (int i = 0; i < Model.TestSections.Count(); i++)
                        {
                            for (int j = 0; j < Model.TestSections[i].QuestionDetails.Count(); j++)
                            {

                                if (i == 0)
                                {

                                    <atricle id="q_@Model.TestSections[i].QuestionDetails[j].QuestionNumber" data-rowkey="@Model.TestSections[i].RowKey" data-section="Section0" style="">



                                        <h2 class="m-0">QUESTION @Model.TestSections[i].QuestionDetails[j].QuestionNumber</h2>
                                        <hr class="m-0">
                                        @Html.Raw(Model.TestSections[i].TestSectionFileName)
                                        <div class="form-group mceNonEditable" data-key="Question" data-question="@Model.TestSections[i].QuestionDetails[j].QuestionNumber" data-questiontype="@Model.TestSections[i].QuestionDetails[j].QuestionTypeKey">
                                            @for (int k = 0; k < Model.TestSections[i].QuestionDetails[j].QuestionOptions.Count(); k++)
                                            {

                                                <div class="custom-control">
                                                    <input QuestionNumber="@Model.TestSections[i].QuestionDetails[j].QuestionNumber" id='@(Model.TestSections[i].QuestionDetails[j].QuestionNumber + "" + k + "_QuestionNumber")' name="[@Model.TestSections[i].QuestionDetails[j].QuestionNumber].QuestionNumber" type="checkbox" data-val="@Model.TestSections[i].QuestionDetails[j].QuestionOptions[k].OptionValue" value="@Model.TestSections[i].QuestionDetails[j].QuestionOptions[k].RowKey" class="custom-control-input QuestionOptions" spellcheck="false"> <label class="custom-control-label" for="@(Model.TestSections[i].QuestionDetails[j].QuestionNumber + "" + k + "_QuestionNumber")" data-val="@Model.TestSections[i].QuestionDetails[j].QuestionOptions[k].OptionValue">
                                                        @Model.TestSections[i].QuestionDetails[j].QuestionOptions[k].OptionValue

                                                        @if (Model.TestSections[i].QuestionDetails[j].QuestionOptions[k].OptionText != null && @Model.TestSections[i].QuestionDetails[j].QuestionOptions[k].OptionText != "")
                                                        {
                                                            <span> - @Model.TestSections[i].QuestionDetails[j].QuestionOptions[k].OptionText</span>
                                                        }
                                                    </label>
                                                </div>


                                            }

                                        </div>
                                        @if (Model.IsShowAllQuestions)
                                        {
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <a questionstatus="@DbConstants.QuestionStatus.Answered" questionnumber="@Model.TestSections[i].QuestionDetails[j].QuestionNumber" id="btn_@Model.TestSections[i].QuestionDetails[j].QuestionNumber" class="QuestionStatus" style="background-color: rgb(23, 169, 52);">Save</a>
                                                    <a questionstatus="@DbConstants.QuestionStatus.NotVisited" questionnumber="@Model.TestSections[i].QuestionDetails[j].QuestionNumber" id="btn_@Model.TestSections[i].QuestionDetails[j].QuestionNumber" class="QuestionStatus" style="background-color: rgb(221, 229, 230);color:black !important">Clear</a>
                                                    <a questionstatus="@DbConstants.QuestionStatus.AnsweredAndMarkedForReview" questionnumber="@Model.TestSections[i].QuestionDetails[j].QuestionNumber" id="btn_@Model.TestSections[i].QuestionDetails[j].QuestionNumber" class="QuestionStatus" style="background-color: rgb(240, 173, 78);"><i style="display:none" class="fa fa-check trueIcon"></i> Answered & Marked For Review</a>
                                                    <a questionstatus="@DbConstants.QuestionStatus.Markedforreview" questionnumber="@Model.TestSections[i].QuestionDetails[j].QuestionNumber" id="btn_@Model.TestSections[i].QuestionDetails[j].QuestionNumber" class="QuestionStatus" style="background-color: rgb(40, 96, 144);"><i style="display:none" class="fa fa-check trueIcon"></i> Marked For Review </a>
                                                </div>
                                            </div>
                                        }
                                    </atricle>
                                }
                                else
                                {
                                    <atricle id="q_@Model.TestSections[i].QuestionDetails[j].QuestionNumber" style="display:@display" data-rowkey="@Model.TestSections[i].RowKey" data-section="Section0">
                                        @Html.HiddenFor(m => m.TestSections[i].QuestionDetails[j].QuestionDuration)

                                        <h2 class="m-0">QUESTION @Model.TestSections[i].QuestionDetails[j].QuestionNumber</h2>
                                        <hr class="m-0">
                                        @Html.Raw(Model.TestSections[i].TestSectionFileName)
                                        <div class="form-group mceNonEditable" data-key="Question" data-question="@Model.TestSections[i].QuestionDetails[j].QuestionNumber" data-questiontype="@Model.TestSections[i].QuestionDetails[j].QuestionTypeKey">
                                            @for (int k = 0; k < Model.TestSections[i].QuestionDetails[j].QuestionOptions.Count(); k++)
                                            {

                                                <div class="custom-control">
                                                    <input QuestionNumber="@Model.TestSections[i].QuestionDetails[j].QuestionNumber" id='@(Model.TestSections[i].QuestionDetails[j].QuestionNumber + "" + k + "_QuestionNumber")' name="[@Model.TestSections[i].QuestionDetails[j].QuestionNumber].QuestionNumber" type="checkbox" data-val="@Model.TestSections[i].QuestionDetails[j].QuestionOptions[k].OptionValue" value="@Model.TestSections[i].QuestionDetails[j].QuestionOptions[k].RowKey" class="custom-control-input QuestionOptions" spellcheck="false"> <label class="custom-control-label" for="@(Model.TestSections[i].QuestionDetails[j].QuestionNumber + "" + k + "_QuestionNumber")" data-val="@Model.TestSections[i].QuestionDetails[j].QuestionOptions[k].OptionValue">
                                                        @Model.TestSections[i].QuestionDetails[j].QuestionOptions[k].OptionValue

                                                        @if (Model.TestSections[i].QuestionDetails[j].QuestionOptions[k].OptionText != null && @Model.TestSections[i].QuestionDetails[j].QuestionOptions[k].OptionText != "")
                                                        {
                                                            <span> - @Model.TestSections[i].QuestionDetails[j].QuestionOptions[k].OptionText</span>
                                                        }
                                                    </label>
                                                </div>


                                            }

                                        </div>
                                        @if (Model.IsShowAllQuestions)
                                        {
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <a questionstatus="@DbConstants.QuestionStatus.Answered" questionnumber="@Model.TestSections[i].QuestionDetails[j].QuestionNumber" id="btn_@Model.TestSections[i].QuestionDetails[j].QuestionNumber" class="QuestionStatus" style="background-color: rgb(23, 169, 52);">Save</a>
                                                    <a questionstatus="@DbConstants.QuestionStatus.NotVisited" questionnumber="@Model.TestSections[i].QuestionDetails[j].QuestionNumber" id="btn_@Model.TestSections[i].QuestionDetails[j].QuestionNumber" class="QuestionStatus" style="background-color: rgb(221, 229, 230);color:black !important">Clear</a>
                                                    <a questionstatus="@DbConstants.QuestionStatus.AnsweredAndMarkedForReview" questionnumber="@Model.TestSections[i].QuestionDetails[j].QuestionNumber" id="btn_@Model.TestSections[i].QuestionDetails[j].QuestionNumber" class="QuestionStatus" style="background-color: rgb(240, 173, 78);"><i style="display:none" class="fa fa-check trueIcon"></i>Answered & Marked For Review</a>
                                                    <a questionstatus="@DbConstants.QuestionStatus.Markedforreview" questionnumber="@Model.TestSections[i].QuestionDetails[j].QuestionNumber" id="btn_@Model.TestSections[i].QuestionDetails[j].QuestionNumber" class="QuestionStatus" style="background-color: rgb(40, 96, 144);"><i style="display:none" class="fa fa-check trueIcon"></i>Marked For Review  </a>
                                                </div>
                                            </div>
                                        }

                                    </atricle>
                                }
                            }
                        }

                    </div>

                    <div class="form-row justify-content-between mt-2">
                        @if (!Model.IsShowAllQuestions)
                        {
                            <div data-hidden id="dvQuestionNumber" class="col-12 col-sm-8 col-lg-10">

                            </div>
                        }
                        <div class="col-12 col-sm-12 col-lg-12">
                            <div class="form-group examButtons">

                                @if (!Model.IsShowAllQuestions)
                                {
                                    <button type="button" style="background-color: #17a934;" id="btnSave" data-hidden class="btn btn-sm btn-success mx-1 float-left"> @EduSuiteUIResources.SaveAndNext</button>
                                    <button type="button" style="background-color: rgb(221 229 230); color: black !important;" data-hidden id="btnClear" class="btn btn-sm btn-info mx-1 float-left"> Clear</button>
                                    <button type="button" style="background-color: #f0ad4e;" id="btnSaveAndMark" data-hidden class="btn btn-sm btn-info mx-1 float-left"> @EduSuiteUIResources.SaveAndMarkedForReview</button>

                                    <button type="button" style="background-color: #286090;" id="MarkForReviewAndNext" data-hidden class="btn btn-sm btn-danger mx-1 float-left">@EduSuiteUIResources.MarkForReviewAndNext</button>
                                }




                            </div>
                        </div>

                        <div data-hidden id="btnExamSubmit" style="    margin-top: 20px;  padding-top: 11px;border: 0px solid rgb(230, 226, 218);  text-align: center;background: rgb(241 242 253);padding-bottom: 11px;max-width: 95% !important;float: left; padding-left: 16px;" class="col-12 col-sm-12 col-lg-12">
                            <div class="form-group">
                                @if (!Model.IsShowAllQuestions)
                                {
                                    <button type="button" style="background-color:rgb(255 255 255); color: black !important; display: inline-block;    margin: 0px;" id="btnBack" data-hidden class="btn btn-sm btn-danger mx-1 float-left"><< Back</button>
                                    <button type="button" style="background-color: rgb(255 255 255); color: black !important; display: inline-block;  margin: 0px;" id="btnNext" data-hidden class="btn btn-sm btn-danger mx-1 float-left">Next >></button>
                                }

                                @if (!Model.IsShowAllQuestions)
                                {

                                    <a id="btnSubmitExam" class="btn btn-sm btn-danger mx-1 float-left"> @EduSuiteUIResources.SubmitExam </a>
                                }
                                else
                                {

                                    <button type="button" style="background-color: #17a934;" id="btnSaveAll" data-hidden class="btn btn-sm btn-success mx-1 float-left"> @EduSuiteUIResources.Submit</button>


                                }
                            </div>
                        </div>

                        <div class="col-12">
                            <span class="ValidateDataMsg"> @Html.ValidationMessage("error_msg")  </span>
                        </div>
                    </div>
                </div>

            </div>
            <div id="supportFileModal" class="modal fade" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-xl">

                    <div class="modal-content">
                        <div class="modal-body">
                            <button type="button" class="badge badge-danger export-buttons" data-dismiss="modal">&times;</button>
                            <div id="dvSupportFile">

                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <audio id="audBeep" src="~/beep.wav" type="audio/ogg"></audio>

        </section>
    }



    <style>
        body {
            overflow-y: scroll;
        }
    </style>
}
<script>
    var jsonData=@(Html.Raw(Json.Encode(new TestQuestionViewModel())));
    var jsonDetailData=@(Html.Raw(Json.Encode(new TestQuestionViewModel())));
    var responseJson=@(Html.Raw(Json.Encode(Model)));
    $(document).ready(function () {
        AppCommon.FormatInputCase();
        //$("#tab-questionmodule li a").each(function(){
        //    var key=this.dataset.val;
        //    data=Resources.ModuleConfig.filter(function(item){
        //        return item.RowKey==key
        //    })[0];
        //    $("#tp-bg",this).addClass(data.color);
        //    $("#tp-icon",this).addClass(data.icon);
        //})
        ExamTest.PreventMultiChecking();

        ExamTest.LoadExamInstruction();

        $("button", $('#dvQuestionNumber')).on("click", function ()
        {
            if ($("#hdnIsShowAllQuestions").val() == "False") {
                var ExamTestSectionKey = $("#ExamTestSectionKey").val();
                if (!parseInt(ExamTestSectionKey)) {
                    $("atricle", $('#dvExamPaper')).hide();
                }
            }

            var question = this.dataset.question;
            if ($("#hdnIsShowAllQuestions").val() == "False")
            {

                $("atricle", $('#dvExamPaper')).hide();

                if (question) {
                    $("[data-question=" + question + "]", $('#dvExamPaper')).closest("atricle").show();
                    $("[data-question=" + question + "]", $('#dvExamPaper')).focus();

                } else {
                    var section = $(this).find("span").html();
                    $("[data-section='" + section + "']", $('#dvExamPaper')).show();

                }
            }
            else {
                $('html, body').animate({
                    scrollTop: $("#q_" + question).offset().top-(200)
                }, 500);
            }





        });

    });
    $(window).on("load",function () {




        $('#tab-questionmodule li a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            $("#ModuleKey").val(this.dataset.val);
            ExamTest.QuestionPaperDetail();
        });




        $("#btnStart").on("click", function () {



            if ($("#chkAgree").prop("checked") == true)
            {
                ExamTest.StartExam();
            }
            else
            {
                alert("Please accept terms and conditions before proceeding.");
            }


        })
        $("#supportFileModal").one('show.bs.modal', function () {
            var file = $(this).data("url");
            var iFrame =   '<div  style="width: 100%; height: 100vh; position: relative;">'
           +'<iframe id="ifrmSupportFile" src="https://docs.google.com/gview?url=' + file + '&embedded=true"  width="100%" height="100%" frameborder="0" scrolling="no" seamless=""></iframe>'
           +'<div style="width: 80px; height: 80px; position: absolute; opacity: 0; right: 0px; top: 0px;">&nbsp;</div></div>'
            $("#dvSupportFile").html(iFrame);

            var head = $("#ifrmSupportFile",$("#dvSupportFile")).contents().find("head");
            var script = "<script>document.querySelectorAll('[aria-label=Pop-out]').remove()<\/script>"
            $(head).append(script);
        })

        if (@Model.ExamStatusKey!=@DbConstants.OnlineExamStatus.Started)
        {
            @*$('#tab-questionmodule li a').removeClass("disabled");
            var nextTab= $('#tab-questionmodule li a[data-val=@Model.ModuleKey]').closest("li").next().find("a");
            if(nextTab[0])
                $(nextTab).trigger("click").addClass("active");
            else
                $('#tab-questionmodule li a').eq(0).trigger("click").addClass("active");*@


            $(".tabs-section-nav,#btnSave,#dvAudioFile,#dvSupportFile").show();
            //$("#btnStart").hide();
            $("#btnSave").hide();

            //ExamTest.QuestionPaperDetail();
        }
        else
        {
            //$("#tab-questionmodule li a").eq(0).addClass("active")
            //ExamTest.LoadExamInstruction();
        }
        document.onkeydown = function (e) {
            return (e.which || e.keyCode) != 116;
        };
    });
    //window.onbeforeunload = function (e) {
    //    return "You have moved out from current exam window.You are not allowed to move out from exam page.If you continue to do like this your exam will be terminated !.";

    //};
</script>


@*<script>
        $(document).ready(function () {
            $("button").on("click", function () {
                alert("hello");
            })
        });

    </script>*@


<script>
    $(document).ready(function () {
        AddCount();
        if ($("#hdnIsShowAllQuestions").val() == "False") {
            $('[data-question="1"]').trigger("click");
        }

        var TestPaperKey = $("#TestPaperKey").val();
        var ApplicationKey = $("#ApplicationKey").val();
    });

    var CurrentTargetPage;


    $(document).on('click', '#btnClear', function (e) {

        var QuestionStatusKey = parseInt($(".CurrentPage").attr("data-question"));

        $('atricle div[data-question="' + QuestionStatusKey + '"]  input[type="checkbox"]').prop("checked", false);

    });




    $(document).on('change', '.QuestionOptions', function (e) {

        if ($("#hdnIsShowAllQuestions").val() == "True")
        {
            var QuestionNumber = $(this).attr("questionnumber");

            if ($(this).prop("checked") == true)
            {
                //var NextQn = parseInt(QuestionNumber) + 1;
                $('button[data-question="' + QuestionNumber + '"]').attr("data-questionstatus", 3);
                //$('button[data-question="' + NextQn + '"]').trigger("click");
                $('a[questionstatus="3"]a[questionnumber="' + QuestionNumber + '"]').trigger("click");

            }
            else {
                $('button[data-question="' + QuestionNumber + '"]').attr("data-questionstatus", 2);
                $('a[questionnumber="' + QuestionNumber + '"]').removeClass("active");
            }
            AddCount();
        }
    });



    $(document).on('click', '#btnNext', function (e) {


        $(CurrentTargetPage).next().trigger("click");

    });





    $(document).on('click', '#btnBack', function (e) {


        $(CurrentTargetPage).prev().trigger("click");

    });

    $(document).on('click', '.QuestionStatus', function (e) {

        var QuestionNumber = $(this).attr("questionnumber"); //statuschange
        var QuestionStatus = $(this).attr("questionstatus");
        $('button[data-question="' + QuestionNumber + '"]').attr("data-questionstatus", QuestionStatus);


        if (QuestionStatus ==@DbConstants.QuestionStatus.NotVisited) {
            $('input[questionnumber="' + QuestionNumber+'"]').prop("checked", false);
            $('#q_' + QuestionNumber + ' .QuestionStatus').removeClass("active");
        }
        else {

            $('#q_' + QuestionNumber + ' .QuestionStatus').removeClass("active");
            $(this).addClass("active");


        }
        AddCount();

    });




    $(document).on('click', '#dvQuestionNumber button', function (e)
    {
        if ($("#hdnIsShowAllQuestions").val() == "False") {
            CurrentTargetPage = e.currentTarget;

            var QuestionStatusKey = $(e.currentTarget).attr("data-questionStatus");

            if (QuestionStatusKey == 1) {
                $(e.currentTarget).attr("data-questionStatus", 2);
            }

            $("#QuestionNumber").val($(e.currentTarget).attr("data-question"));

            $("#dvQuestionNumber button").removeClass("CurrentPage");
            $(e.currentTarget).addClass("CurrentPage");



            AddCount();
        }
    });


    $("#btnSave").on("click", function () {

        var QuestionNumber = $(CurrentTargetPage).attr("data-question");
        var IsDefined = $('#dvExamPaper atricle:nth-child(' + QuestionNumber + ') input[type="checkbox"]');

        if ($('#dvExamPaper atricle:nth-child(' + QuestionNumber + ') input[type="checkbox"]:checked').length > 0 || IsDefined.length == 0) {
            ExamTest.FormSubmit(this, 3);

        }
        else if (IsDefined.length > 0) {
            alert("Please choose an option");
        }
    });

    $("#btnSaveAll").on("click", function () {
        $.confirm({
            title: 'Confirm!',
            content: 'Are your sure complete Exam?',
            buttons: {

                confirm: function () {
                    ExamTest.FormSubmit(this, 3);
                },
                cancel: function () {

                }

            }
        });


    });


    $("#btnSubmitExam").on("click", function () {
        $.confirm({
            title: 'Confirm!',
            content: 'Are your sure complete Exam?',
            buttons: {

                confirm: function () {
                    window.location.href = $("#hdnComplateExam").val();
                },
                cancel: function () {

                }

            }
        });


    });


    $("#btnSaveAndMark").on("click", function () {
        var QuestionNumber = $(CurrentTargetPage).attr("data-question");
        var IsDefined = $('#dvExamPaper atricle:nth-child(' + QuestionNumber + ') input[type="checkbox"]');

        if ($('#dvExamPaper atricle:nth-child(' + QuestionNumber + ') input[type="checkbox"]:checked').length > 0 || IsDefined.length == 0) {
            ExamTest.FormSubmit(this, 5);
        }
        else if (IsDefined.length > 0) {
            alert("Please choose an option");
        }

    });
    $("#MarkForReviewAndNext").on("click", function () {

        ExamTest.FormSubmit(this, 4);
    });


</script>

<script>

    function AddCount() {
        $("#NtVisitedCount").html($('[data-questionstatus="1"]').length);
        $("#NtAnsweredCount").html($('[data-questionstatus="2"]').length);
        $("#AnsweredCount").html($('[data-questionstatus="3"]').length);
        $("#MarkedForReviewCount").html($('[data-questionstatus="4"]').length);
        $("#AnsweredMarkedForReviewCount").html($('[data-questionstatus="5"]').length);
    }



</script>


<style>
    div#dvExamInstructions {
        padding-left: 10%;
    }

    [data-questionstatus="1"], #NtVisitedCount {
        background-color: #e8e9eceb !important;
        /* color: black !important; */
        border-top-right-radius: 14px !important;
        border-bottom-left-radius: 14px !important;
        border-radius: 4px !important;
        border: solid #cecdcc 1px;
    }

    [data-questionstatus="2"], #NtAnsweredCount {
        background: #ce0909 !important;
        border-radius: 0px !important;
        color: white !important;
        box-shadow: none !important;
    }

        [data-questionstatus="2"]::after, #NtAnsweredCount::after {
            content: "";
            display: inline-block;
            position: absolute;
            width: 49px !important;
            height: 12px !important;
            background: white;
            transform: rotate(9deg);
            margin-top: -13px;
            margin-left: -28px;
        }

        [data-questionstatus="2"]::after {
            content: "";
            display: inline-block;
            position: absolute;
            width: 49px !important;
            height: 12px !important;
            background: white;
            transform: rotate(9deg);
            margin-top: -16px;
            margin-left: -28px;
        }

    [data-questionstatus="3"], #AnsweredCount {
        background: #14ad12 !important;
        border-radius: 2px !important;
        color: white !important;
        box-shadow: none;
    }

        [data-questionstatus="3"]::after, #AnsweredCount::after {
            content: "";
            display: inline-block;
            position: absolute;
            width: 49px !important;
            height: 12px !important;
            background: white;
            transform: rotate(9deg);
            margin-top: -13px;
            margin-left: -28px;
        }

        [data-questionstatus="3"]::after {
            content: "";
            display: inline-block;
            position: absolute;
            width: 49px !important;
            height: 12px !important;
            background: white;
            transform: rotate(9deg);
            margin-top: -16px;
            margin-left: -28px;
        }

    [data-questionstatus="4"], #MarkedForReviewCount {
        /* background: #2816b9 !important; */
        color: white !important;
        border-radius: 50% !important;
        background: linear-gradient(0deg, rgb(29 37 88) 0%, rgb(125 58 232) 100%);
    }


    [data-questionstatus="5"], #AnsweredMarkedForReviewCount {
        /* background: #2816b9 !important; */
        color: white !important;
        border-radius: 50% !important;
        background: linear-gradient(0deg, rgb(29 37 88) 0%, rgb(125 58 232) 100%);
    }

        [data-questionstatus="5"]:after, #AnsweredMarkedForReviewCount:after {
            content: "";
            display: inline-block;
            position: absolute;
            background: #2ae127;
            width: 10px;
            height: 11px;
            border-radius: 50%;
            margin-top: -6px;
        }


    #dvQuestionNumber button {
        color: black;
        font-weight: bold;
        border: 0px;
        margin-right: 6px;
        width: 38px;
        height: 39px;
        border: 0px !important;
        border-radius: initial;
        border: solid #d3dfe4 1px !important;
        border-radius: 0px;
        box-shadow: none;
    }


        #dvQuestionNumber button.CurrentPage {
            /*background: #e2e0e0 !important;

            color: black !important;
            font-weight: bold;
            font-size: 12px;*/
        }

    .ExamReview {
        float: left;
        /* height: 90px; */
        border: solid #dee1e6 1.1px;
        padding-top: 17px;
        background: white;
        border-radius: 5px;
        text-align: center;
        padding-bottom: 25px;
        overflow: auto;
    }

        .ExamReview table tr td, .ExamReview table tr th {
            width: 20.2%;
            font-size: 12px;
            font-weight: bold;
            font-weight: 600;
            /* text-transform: uppercase; */
            font-size: 12px;
        }

        .ExamReview table {
            width: 100%;
        }

        .ExamReview span {
            min-width: 41px;
            display: inline-block;
            text-align: center;
            font-size: 20px;
            height: 40px;
            color: #13569a;
            padding-top: 5px;
            border-radius: 0px !important;
            border: solid #cbd2ec 0px;
            background: #e7eaf3;
            /* color: white; */
            /* border-top-right-radius: 14px !important; */
            /* border-right: solid #f4b237 6px; */
            box-shadow: 2px 2px 3px #cac5d3;
        }

        .ExamReview tr td, .ExamReview tr th {
            border: solid #bad1dc 1px;
            padding: 12px 4px;
        }

        .ExamReview .fa {
            font-size: 18px;
        }

    div#ExamReview span {
        color: black;
    }

    .exam-paper {
        background: white;
        box-shadow: none;
    }

    .examPersonDetails {
        text-transform: uppercase;
        font-weight: bold;
        font-size: 12px;
        line-height: 24px;
    }

        .examPersonDetails .col:first-child {
            font-weight: 500;
            line-height: 27px;
            text-transform: UPPERCASE;
            font-size: 12px;
        }

    #ExamReview a {
        font-size: 10px !important;
    }

    .PageCommon {
        width: 32px;
        display: inline-block;
        height: 40px;
    }

    a.notVisited {
        background-color: #f1f2fbeb !important;
        /* color: black !important; */
        border: solid #d9d2c6 1px;
    }

    a.MarkedForReview {
        border-radius: 50% !important;
        background: rgb(34,78,195);
        background: linear-gradient(0deg, rgb(146 145 243) 0%, rgb(41 0 106) 100%);
        height: 32px;
    }

    a.AnsweredMarkedForReview {
        border-radius: 50% !important;
        background: rgb(34,78,195);
        background: linear-gradient(0deg, rgb(146 145 243) 0%, rgb(41 0 106) 100%);
        height: 32px;
    }

        a.AnsweredMarkedForReview::after {
            content: "";
            display: inline-block;
            position: absolute;
            background: #2ae127;
            width: 10px;
            height: 11px;
            border-radius: 50%;
            right: 4px;
            margin-top: 4px;
        }

    a.Answered {
        background: #09992e !important;
        border-radius: 0px;
        color: white !important;
    }

    a.NotAnswered {
        background: #bf0707 !important;
        color: white !important;
        /*border-top-right-radius: 14px !important;
        border-bottom-left-radius: 14px !important;*/
    }

    div#dvExamInstructions ol li a.NotAnswered::after {
        content: "";
        display: inline-block;
        position: absolute;
        width: 49px !important;
        height: 12px !important;
        background: white;
        transform: rotate(9deg);
        margin-top: -4px;
        margin-left: -10px;
        z-index: 99;
    }


    div#dvExamInstructions ol li {
        line-height: 31px;
        color: #44444c;
        list-style-type: decimal;
        width: 80%;
        font-weight: 500;
        font-size: 12.1px;
        font-weight: bold;
    }

        div#dvExamInstructions ol li a {
            margin-right: 0px;
            margin-top: 0px;
            position: relative;
            top: 13px;
        }

            div#dvExamInstructions ol li a.Answered::after {
                content: "";
                display: inline-block;
                position: absolute;
                width: 49px !important;
                height: 12px !important;
                background: white;
                transform: rotate(9deg);
                margin-top: -4px;
                margin-left: -10px;
                z-index: 99;
            }

        div#dvExamInstructions ol li span {
            display: block;
        }

        div#dvExamInstructions ol li ol {
            /padding-left: 44px;
            /
        }

    div#dvExamInstructions h3 {
        font-weight: bold;
    }

    div#dvExamInstructions h4 {
        margin: 0px;
        padding: 14px 1px;
        font-weight: bold;
        font-size: 17px;
        text-decoration: underline;
    }

    div#ExamInstructions {
        margin-top: 21px;
        border-top: solid #e2dfda 1px;
    }

    a.QuestionStatus {
        background: black;
        padding: 3px;
        padding: 7px 8px;
        font-size: 10px;
        border-radius: 0px;
        color: white;
        text-transform: uppercase;
        font-weight: 500;
        cursor: pointer;
        border: 0px;
        text-decoration: none;
        display: inline-block;
        float: left;
        margin-right: 4px;
        margin-top: 2px;
    }

        a.QuestionStatus.active::after {
            content: "\f00c";
            display: inline-block;
            font: normal normal normal 14px/1 FontAwesome;
            font-size: inherit;
            text-rendering: auto;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: #62c309;
            padding: 3px 3px;
            position: absolute;
            margin-left: -27px;
            margin-top: -16px;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            text-align: center;
            padding-top: 6px;
            box-shadow: 1px 1px 6px #665c5c;
        }

        a.QuestionStatus:hover {
            color: white;
        }
</style>


<script type="text/javascript">

    function preventBack() { window.history.forward(); }
    setTimeout("preventBack()", 0);
    window.onunload = function () { null };
</script>